1. Error en Propiedades â†’ Condominios (admin de agencia externa)

En el cÃ³digo del front, la pÃ¡gina ExternalCondominiums.tsx hace esta llamada:

GET /api/external-condominiums?isActive=...&search=...&limit=...&offset=...
// si la respuesta NO es 200:
throw new Error("Failed to fetch condominiums");


Por eso ves exactamente el mensaje rojo â€œFailed to fetch condominiumsâ€.

En el backend existe este endpoint:

app.get("/api/external-condominiums", isAuthenticated, requireRole(EXTERNAL_ALL_ROLES), async (req, res) => {
  // 1) Saca agencyId de query ?agencyId=...
  // 2) Si no viene, intenta obtener agencyId del usuario logueado
  //    usando getUserAgencyId(req)
  // 3) Verifica que el usuario pertenezca a esa agencia
  // 4) Llama a storage.getExternalCondominiumsByAgency(...)
});


Los fallos tÃ­picos aquÃ­ son:

El usuario externo no tiene externalAgencyId en la base de datos
â†’ el helper devuelve que el usuario â€œno pertenece a ninguna agenciaâ€ y responde 400/403.

Hay un error en la consulta a DB (storage.getExternalCondominiumsByAgency)
â†’ se lanza excepciÃ³n y el endpoint devuelve 500 â€œError fetching external condominiumsâ€.

EstÃ¡s entrando con un usuario â€œadmin/masterâ€ normal, no con un usuario externo

Para roles admin/master getUserAgencyId devuelve null, y si no envÃ­as ?agencyId= en la URL, tambiÃ©n se responde error.

ğŸ‘‰ QuÃ© decirle al dev sobre esta pantalla:

En /external/condominiums veo el mensaje rojo â€œFailed to fetch condominiumsâ€.

En el Network tab, la peticiÃ³n GET /api/external-condominiums?... estÃ¡ devolviendo error (400/403/500).

Por favor:

Revisa los logs del servidor buscando â€œError fetching external condominiumsâ€.

Verifica que mi usuario externo tenga externalAgencyId asignado en DB.

Confirma que storage.getExternalCondominiumsByAgency y getExternalCondominiumsCountByAgency estÃ¡n implementados y funcionando.

En caso de entrar con rol admin/master, agrega un selector de agencia (dropdown) y que el front envÃ­e ?agencyId=... en la URL, como ya se hace en otras secciones externas.

Con eso deberÃ­an poder encontrar rÃ¡pidamente por quÃ© esa tabla no carga.